{"version":3,"kind":"Notebook","sha256":"1ba6c403d5e6f648a2c9b6831fa19c99b3783690b6d64d7bc26d881a0affaa8b","slug":"notebooks.courses.microwave-remote-sensing.unit-01.in-class-exercise","location":"/notebooks/courses/microwave-remote-sensing/unit_01/01_in_class_exercise.ipynb","dependencies":[],"frontmatter":{"title":"Discover and Read SAR Data","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"Wolfgang Wagner","given":"Wolfgang","family":"Wagner"},"name":"Wolfgang Wagner","id":"contributors-myst-generated-uid-0"},{"nameParsed":{"literal":"Martin Schobben","given":"Martin","family":"Schobben"},"name":"Martin Schobben","id":"contributors-myst-generated-uid-1"},{"nameParsed":{"literal":"Nikolas Pikall","given":"Nikolas","family":"Pikall"},"name":"Nikolas Pikall","id":"contributors-myst-generated-uid-2"},{"nameParsed":{"literal":"Joseph Wagner","given":"Joseph","family":"Wagner"},"name":"Joseph Wagner","id":"contributors-myst-generated-uid-3"},{"nameParsed":{"literal":"Davide Festa","given":"Davide","family":"Festa"},"name":"Davide Festa","id":"contributors-myst-generated-uid-4"},{"nameParsed":{"literal":"Felix David Reuß","given":"Felix David","family":"Reuß"},"name":"Felix David Reuß","id":"contributors-myst-generated-uid-5"},{"nameParsed":{"literal":"Luka Jović","given":"Luka","family":"Jović"},"name":"Luka Jović","id":"contributors-myst-generated-uid-6"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"copyright":"2024","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":2}},"exports":[{"format":"ipynb","filename":"01_in_class_exercise.ipynb","url":"/eo-datascience-cookbook/build/01_in_class_exercise-7b0850fb4668ab1ffa9cc4a6347f1552.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates how to access radar data in a SpatioTemporal Asset Catalog (STAC) Catalogue using the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Coq1Hx7WLb"},{"type":"inlineCode","value":"pystac","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"w1CMSLly4r"},{"type":"text","value":" library. In this example, we use Sentinel-1 data from the EODC (earth observation data and high performance computing service provider based in Vienna) STAC catalog. In the further process, we will learn how to query a STAC catalog, select specific items, and display the metadata and the actual image.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LSCGodpaci"}],"key":"yedcRQvIeL"}],"key":"VGqJ1UyaOI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import folium\nimport pystac_client\nfrom odc import stac as odc_stac","key":"VQIEe5dMv0"},{"type":"outputs","id":"0C0v-jggyPmLFifBJt9Fw","children":[],"key":"oLQvNgnWXG"}],"key":"mLXn5R7rjL"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Data Discovery","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kEL20ftipk"}],"identifier":"data-discovery","label":"Data Discovery","html_id":"data-discovery","implicit":true,"key":"VRGi5POcap"}],"key":"jgI6BM109t"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"eodc_catalog = pystac_client.Client.open(\"https://stac.eodc.eu/api/v1\")\n\neodc_catalog","key":"B0QfzhkmHt"},{"type":"outputs","id":"QCjgjoRAIq3ektDiSe5dX","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":2,"metadata":{},"data":{"text/plain":{"content":"<Client id=stac-fastapi>","content_type":"text/plain"},"text/html":{"content_type":"text/html","hash":"cfe74d50c8827055d27dc4f7e00ea24a","path":"/eo-datascience-cookbook/build/cfe74d50c8827055d27dc4f7e00ea24a.html"}}},"key":"K1QjmeAzbj"}],"key":"pUbfiBGkz4"}],"key":"nTZNPHkW6Q"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The URL ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YirYbhWd84"},{"type":"inlineCode","value":"https://stac.eodc.eu/api/v1","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oe14UwkDBV"},{"type":"text","value":", served over Hypertext Transfer Protocol (HTTP), is a STAC-compliant API endpoint (specific URL address where an API service is available) that leads to the EODC Catalogue. Besides EODC’s, other catalogues can be found on ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gyixNdBGW5"},{"type":"link","url":"https://stacindex.org/catalogs","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"STAC Index","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rurQLNnptC"}],"urlSource":"https://stacindex.org/catalogs","key":"joBOJY5Pvv"},{"type":"text","value":", such as United States Geological Survey (USGS) Landsat imagery, Sentinel Hub, Copernicus Data Space Ecosystem, and so on. Briefly spoken, STAC can be used to search, discover, and access metadata of these datasets with the same code. The EODC Catalogue can be accessed on the web via this ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l1ndGWCiGl"},{"type":"link","url":"https://services.eodc.eu/browser/#/?.language=en","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"link","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ue6d3qbOTr"}],"urlSource":"https://services.eodc.eu/browser/#/?.language=en","key":"rAwWO7yRLx"},{"type":"text","value":" as well.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PjMgPHBN8p"}],"key":"adWoP07UqC"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Each STAC catalog, composed by different providers, has many collections. To get all collections of a catalog, we can print all of them and their ids, which are used to fetch them from the catalog.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nr0yBlpogg"}],"key":"UvmI1BwI65"}],"key":"djBmN9vRgR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"collections = eodc_catalog.get_collections()\n\n# length of string of collection.id, for pretty print\nmax_length = max(len(collection.id) for collection in collections)\n\nfor collection in eodc_catalog.get_collections():\n    print(f\"{collection.id.ljust(max_length)}: {collection.title}\")","key":"l2phPTyTqf"},{"type":"outputs","id":"Ao0FoZFnAM83YjIhsbgUK","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"error","traceback":"\u001b[31m---------------------------------------------------------------------------\u001b[39m\n\u001b[31mAPIError\u001b[39m                                  Traceback (most recent call last)\n\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[3]\u001b[39m\u001b[32m, line 6\u001b[39m\n\u001b[32m      3\u001b[39m \u001b[38;5;66;03m# length of string of collection.id, for pretty print\u001b[39;00m\n\u001b[32m      4\u001b[39m max_length = \u001b[38;5;28mmax\u001b[39m(\u001b[38;5;28mlen\u001b[39m(collection.id) \u001b[38;5;28;01mfor\u001b[39;00m collection \u001b[38;5;129;01min\u001b[39;00m collections)\n\u001b[32m----> \u001b[39m\u001b[32m6\u001b[39m \u001b[38;5;28;43;01mfor\u001b[39;49;00m\u001b[43m \u001b[49m\u001b[43mcollection\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;129;43;01min\u001b[39;49;00m\u001b[43m \u001b[49m\u001b[43meodc_catalog\u001b[49m\u001b[43m.\u001b[49m\u001b[43mget_collections\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\u001b[43m:\u001b[49m\n\u001b[32m      7\u001b[39m \u001b[43m    \u001b[49m\u001b[38;5;28;43mprint\u001b[39;49m\u001b[43m(\u001b[49m\u001b[33;43mf\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[38;5;132;43;01m{\u001b[39;49;00m\u001b[43mcollection\u001b[49m\u001b[43m.\u001b[49m\u001b[43mid\u001b[49m\u001b[43m.\u001b[49m\u001b[43mljust\u001b[49m\u001b[43m(\u001b[49m\u001b[43mmax_length\u001b[49m\u001b[43m)\u001b[49m\u001b[38;5;132;43;01m}\u001b[39;49;00m\u001b[33;43m: \u001b[39;49m\u001b[38;5;132;43;01m{\u001b[39;49;00m\u001b[43mcollection\u001b[49m\u001b[43m.\u001b[49m\u001b[43mtitle\u001b[49m\u001b[38;5;132;43;01m}\u001b[39;49;00m\u001b[33;43m\"\u001b[39;49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/eo-datascience-cookbook/lib/python3.13/site-packages/pystac_client/client.py:436\u001b[39m, in \u001b[36mClient.get_collections\u001b[39m\u001b[34m(self)\u001b[39m\n\u001b[32m    433\u001b[39m \u001b[38;5;28;01massert\u001b[39;00m \u001b[38;5;28mself\u001b[39m._stac_io \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m\n\u001b[32m    435\u001b[39m url = \u001b[38;5;28mself\u001b[39m._collections_href()\n\u001b[32m--> \u001b[39m\u001b[32m436\u001b[39m \u001b[43m\u001b[49m\u001b[38;5;28;43;01mfor\u001b[39;49;00m\u001b[43m \u001b[49m\u001b[43mpage\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;129;43;01min\u001b[39;49;00m\u001b[43m \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43m_stac_io\u001b[49m\u001b[43m.\u001b[49m\u001b[43mget_pages\u001b[49m\u001b[43m(\u001b[49m\u001b[43murl\u001b[49m\u001b[43m)\u001b[49m\u001b[43m:\u001b[49m\n\u001b[32m    437\u001b[39m \u001b[43m    \u001b[49m\u001b[38;5;28;43;01mif\u001b[39;49;00m\u001b[43m \u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mcollections\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m \u001b[49m\u001b[38;5;129;43;01mnot\u001b[39;49;00m\u001b[43m \u001b[49m\u001b[38;5;129;43;01min\u001b[39;49;00m\u001b[43m \u001b[49m\u001b[43mpage\u001b[49m\u001b[43m:\u001b[49m\n\u001b[32m    438\u001b[39m \u001b[43m        \u001b[49m\u001b[38;5;28;43;01mraise\u001b[39;49;00m\u001b[43m \u001b[49m\u001b[43mAPIError\u001b[49m\u001b[43m(\u001b[49m\u001b[33;43m\"\u001b[39;49m\u001b[33;43mInvalid response from /collections\u001b[39;49m\u001b[33;43m\"\u001b[39;49m\u001b[43m)\u001b[49m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/eo-datascience-cookbook/lib/python3.13/site-packages/pystac_client/stac_api_io.py:304\u001b[39m, in \u001b[36mStacApiIO.get_pages\u001b[39m\u001b[34m(self, url, method, parameters)\u001b[39m\n\u001b[32m    292\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mget_pages\u001b[39m(\n\u001b[32m    293\u001b[39m     \u001b[38;5;28mself\u001b[39m,\n\u001b[32m    294\u001b[39m     url: \u001b[38;5;28mstr\u001b[39m,\n\u001b[32m    295\u001b[39m     method: \u001b[38;5;28mstr\u001b[39m | \u001b[38;5;28;01mNone\u001b[39;00m = \u001b[38;5;28;01mNone\u001b[39;00m,\n\u001b[32m    296\u001b[39m     parameters: \u001b[38;5;28mdict\u001b[39m[\u001b[38;5;28mstr\u001b[39m, Any] | \u001b[38;5;28;01mNone\u001b[39;00m = \u001b[38;5;28;01mNone\u001b[39;00m,\n\u001b[32m    297\u001b[39m ) -> Iterator[\u001b[38;5;28mdict\u001b[39m[\u001b[38;5;28mstr\u001b[39m, Any]]:\n\u001b[32m    298\u001b[39m \u001b[38;5;250m    \u001b[39m\u001b[33;03m\"\"\"Iterator that yields dictionaries for each page at a STAC paging\u001b[39;00m\n\u001b[32m    299\u001b[39m \u001b[33;03m    endpoint, e.g., /collections, /search\u001b[39;00m\n\u001b[32m    300\u001b[39m \n\u001b[32m    301\u001b[39m \u001b[33;03m    Return:\u001b[39;00m\n\u001b[32m    302\u001b[39m \u001b[33;03m        Dict[str, Any] : JSON content from a single page\u001b[39;00m\n\u001b[32m    303\u001b[39m \u001b[33;03m    \"\"\"\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m304\u001b[39m     page = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mread_json\u001b[49m\u001b[43m(\u001b[49m\u001b[43murl\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mmethod\u001b[49m\u001b[43m=\u001b[49m\u001b[43mmethod\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mparameters\u001b[49m\u001b[43m=\u001b[49m\u001b[43mparameters\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    305\u001b[39m     \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m (page.get(\u001b[33m\"\u001b[39m\u001b[33mfeatures\u001b[39m\u001b[33m\"\u001b[39m) \u001b[38;5;129;01mor\u001b[39;00m page.get(\u001b[33m\"\u001b[39m\u001b[33mcollections\u001b[39m\u001b[33m\"\u001b[39m)):\n\u001b[32m    306\u001b[39m         \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/eo-datascience-cookbook/lib/python3.13/site-packages/pystac/stac_io.py:200\u001b[39m, in \u001b[36mStacIO.read_json\u001b[39m\u001b[34m(self, source, *args, **kwargs)\u001b[39m\n\u001b[32m    183\u001b[39m \u001b[38;5;28;01mdef\u001b[39;00m\u001b[38;5;250m \u001b[39m\u001b[34mread_json\u001b[39m(\u001b[38;5;28mself\u001b[39m, source: HREF, *args: Any, **kwargs: Any) -> \u001b[38;5;28mdict\u001b[39m[\u001b[38;5;28mstr\u001b[39m, Any]:\n\u001b[32m    184\u001b[39m \u001b[38;5;250m    \u001b[39m\u001b[33;03m\"\"\"Read a dict from the given source.\u001b[39;00m\n\u001b[32m    185\u001b[39m \n\u001b[32m    186\u001b[39m \u001b[33;03m    See :func:`StacIO.read_text <pystac.StacIO.read_text>` for usage of\u001b[39;00m\n\u001b[32m   (...)\u001b[39m\u001b[32m    198\u001b[39m \u001b[33;03m        given source.\u001b[39;00m\n\u001b[32m    199\u001b[39m \u001b[33;03m    \"\"\"\u001b[39;00m\n\u001b[32m--> \u001b[39m\u001b[32m200\u001b[39m     txt = \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mread_text\u001b[49m\u001b[43m(\u001b[49m\u001b[43msource\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    201\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28mself\u001b[39m.json_loads(txt)\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/eo-datascience-cookbook/lib/python3.13/site-packages/pystac_client/stac_api_io.py:167\u001b[39m, in \u001b[36mStacApiIO.read_text\u001b[39m\u001b[34m(self, source, *args, **kwargs)\u001b[39m\n\u001b[32m    165\u001b[39m href = \u001b[38;5;28mstr\u001b[39m(source)\n\u001b[32m    166\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m _is_url(href):\n\u001b[32m--> \u001b[39m\u001b[32m167\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[38;5;28;43mself\u001b[39;49m\u001b[43m.\u001b[49m\u001b[43mrequest\u001b[49m\u001b[43m(\u001b[49m\u001b[43mhref\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43m*\u001b[49m\u001b[43m*\u001b[49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[32m    168\u001b[39m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[32m    169\u001b[39m     \u001b[38;5;28;01mwith\u001b[39;00m \u001b[38;5;28mopen\u001b[39m(href) \u001b[38;5;28;01mas\u001b[39;00m f:\n\n\u001b[36mFile \u001b[39m\u001b[32m~/micromamba/envs/eo-datascience-cookbook/lib/python3.13/site-packages/pystac_client/stac_api_io.py:219\u001b[39m, in \u001b[36mStacApiIO.request\u001b[39m\u001b[34m(self, href, method, headers, parameters)\u001b[39m\n\u001b[32m    217\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m APIError(\u001b[38;5;28mstr\u001b[39m(err))\n\u001b[32m    218\u001b[39m \u001b[38;5;28;01mif\u001b[39;00m resp.status_code != \u001b[32m200\u001b[39m:\n\u001b[32m--> \u001b[39m\u001b[32m219\u001b[39m     \u001b[38;5;28;01mraise\u001b[39;00m APIError.from_response(resp)\n\u001b[32m    220\u001b[39m \u001b[38;5;28;01mtry\u001b[39;00m:\n\u001b[32m    221\u001b[39m     \u001b[38;5;28;01mreturn\u001b[39;00m resp.content.decode(\u001b[33m\"\u001b[39m\u001b[33mutf-8\u001b[39m\u001b[33m\"\u001b[39m)\n\n\u001b[31mAPIError\u001b[39m: Bad Gateway","ename":"APIError","evalue":"Bad Gateway"},"key":"ph0FbJUwHe"}],"key":"l6xVuMVgCs"}],"key":"rS6aMkKXYj"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To get a specific collection from the catalog, we can use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vg232S07dw"},{"type":"inlineCode","value":"client.get_collection()","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n9EiO069VI"},{"type":"text","value":" method and provide the collection name. We can then display its description, id, temporal and spatial extent, license, etc. In this notebook, we will work with the Sentinel-1 sigma naught 20m collection.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GbVQdkGXx0"}],"key":"lDthZ4cH8v"}],"key":"lssa2eUM7n"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"colllection_id = \"SENTINEL1_SIG0_20M\"\n\ncollection = eodc_catalog.get_collection(colllection_id)\ncollection","key":"cF9GrNPTF0"},{"type":"outputs","id":"vkKNl77ZjvFEGBYQVNyV3","children":[],"key":"BV6iWUOEUA"}],"key":"W63mOSJOCS"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Each collection has multiple items. An item is one spatio-temporal instance in the collection, for instance a satellite image. If items are needed for a specific timeframe or for a specific region of interest, we can define this as a query.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yI9pYA5qjM"}],"key":"BOtPmrlTqe"}],"key":"ynuCHvpxzy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"time_range = \"2022-10-01/2022-10-07\"  # a closed range\n# time_range = \"2022-01\"  # whole month, same can be done for a year and a day\n# time_range = \"2022-01-01/..\"  # up to the current date, an open range\n# time_range = \"2022-01-01T05:34:46\"  # a specific time instance","key":"O8pJRXGKU4"},{"type":"outputs","id":"11x_iCwc62aSao1PVx7Wx","children":[],"key":"rus17lRvUJ"}],"key":"UTslyRHbr9"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"A spatial region of interest can be defined in different ways. One option is to define a simple bounding box:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gtLFTb92NA"}],"key":"Ezz2AdGNnW"}],"key":"epJ3l0QZAL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"latmin, latmax = 46.3, 49.3  # South to North\nlonmin, lonmax = 13.8, 17.8  # West to East\n\nbounding_box = [lonmin, latmin, lonmax, latmax]","key":"NvhyOk0nRm"},{"type":"outputs","id":"_d-yw00o65cr5dAah18bg","children":[],"key":"QjcrsWrXnl"}],"key":"FpGXYuqrez"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If the region of interest is not rectangular, we can also define a polygon:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I27wzkQjiz"}],"key":"NT3p73cNMc"}],"key":"M37Po1lonv"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# GEOJSON can be created on geojson.io\n\n# This specific area of interest is a rectangle, but since it is\n# a closed polygon it seems like it has five nodes\n\narea_of_interest = {\n    \"coordinates\": [\n        [\n            [17.710928010825853, 49.257630084442496],\n            [13.881798300915221, 49.257630084442496],\n            [13.881798300915221, 46.34747715326259],\n            [17.710928010825853, 46.34747715326259],\n            [17.710928010825853, 49.257630084442496],\n        ]\n    ],\n    \"type\": \"Polygon\",\n}","key":"L2nWk4shtg"},{"type":"outputs","id":"AUjtuGkHUcFjLU57ZQaXr","children":[],"key":"snXLfp8WC1"}],"key":"g6qlJXfmvK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Using our previously loaded STAC catalog, we can now search for items fullfilling our query. In this example we are using the bounding box. If we want to use an area of interest specified in the geojson format - one has to use the intersects parameter as documented in the comment below.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"J1FFOFYcT0"}],"key":"LsK1l8WmZE"}],"key":"R5kVnuT2iF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"search = eodc_catalog.search(\n    collections=colllection_id,  # can also be a list of several collections\n    bbox=bounding_box,  # search by bounding box\n    # intersects=area_of_interest,  # GeoJSON search\n    datetime=time_range,\n    # max_items=1  # number of max items to load\n)\n\n# If we comment everything besides colllection_id, we will load whole\n# collection for available region and time_range\n\nitems_eodc = search.item_collection()\nprint(f\"On EODC we found {len(items_eodc)} items for the given search query\")","key":"lck7CEUmaW"},{"type":"outputs","id":"GbnDE1WDKs3vsBnf9c6hI","children":[],"key":"DW2JY8yB4B"}],"key":"YBcJyUvfBM"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, we can fetch a single item, in this case a Sentinel-1 image, from the query results. A good practice is to always check what metadata the data provider has stored on the item level. This can be done by looking into the item properties.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"upT1zWYqNR"}],"key":"QzPRimolcA"}],"key":"Ngx4YyqPXP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"item = items_eodc[0]\nitem.properties","key":"shOH2b7xgh"},{"type":"outputs","id":"7ege1D7MUvDq7NX0lJrAl","children":[],"key":"PDTOODESTG"}],"key":"Mdv3IE3icz"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"For now, let’s display only the vertical-vertical (VV) polarized band of the item and some information about the data.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pwqOEqTPzz"}],"key":"RF5RbmoXk0"}],"key":"NvkmgFcBpJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"item.assets[\"VV\"].extra_fields.get(\"raster:bands\")[0]","key":"fiU3ovPJ9i"},{"type":"outputs","id":"NGXBH1cthpAElsldlzhft","children":[],"key":"IBOMHeNrKD"}],"key":"emfzN07vUd"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In the EODC STAC catalogue an item can conveniently be displayed using its thumbnail.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UIlW252FXv"}],"key":"RxuSXHr5Ng"}],"key":"R2z6obtE9T"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"item.assets[\"thumbnail\"].href","key":"IDg8F2YNDa"},{"type":"outputs","id":"BSnY8lC2yk-ec3ulDzLWb","children":[],"key":"hujzJ0OsoN"}],"key":"UIWlMCUhEj"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we will plot the data on a map using the thumbnail and the python package ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"a4Y8CrKojL"},{"type":"link","url":"https://python-visualization.github.io/folium/latest/user_guide.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"folium","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UTGtaN6f0g"}],"urlSource":"https://python-visualization.github.io/folium/latest/user_guide.html","key":"uxjXX0aBjf"},{"type":"text","value":". This is an easy way to quickly check how the data found by a search query looks on a map.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RkdxRVYYg1"}],"key":"X2ejRlgALh"}],"key":"zG4X6Ipvp9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"map = folium.Map(\n    location=[(latmin + latmax) / 2, (lonmin + lonmax) / 2],\n    zoom_start=7,\n    zoom_control=False,\n    scrollWheelZoom=False,\n    dragging=False,\n)\n\nfolium.GeoJson(area_of_interest, name=\"Area of Interest\").add_to(map)\n\nfor item in items_eodc:\n    # url leading to display of an item, can also be used as hyperlink\n    image_url = item.assets[\"thumbnail\"].href\n    bounds = item.bbox\n    folium.raster_layers.ImageOverlay(\n        image=image_url,\n        bounds=[[bounds[1], bounds[0]], [bounds[3], bounds[2]]],\n    ).add_to(map)\n\nfolium.LayerControl().add_to(map)\n\nmap","key":"yurqoOsJ91"},{"type":"outputs","id":"S5rSmod2NsKBMVdBgMgZJ","children":[],"key":"gevSy0xO80"}],"key":"f49QD1ZAKn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure 1: Map of study area. Blue rectangle is the area covered by the discovered data.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ebVayexcOO"}],"key":"KB31p7Weo6"}],"key":"wTHPnIH2Fi"},{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Data Reading","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"iZvtqRny42"}],"identifier":"data-reading","label":"Data Reading","html_id":"data-reading","implicit":true,"key":"JVx7RTBv3c"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"STAC can also be a useful tool for the discovery of data, however it only loads metadata. This saves memory, but if one would like to do further analysis, the data has to be loaded into memory or downloaded on disk.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SjA97xNJuq"}],"key":"ZSfbFdfCv2"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"In the following, we will demonstrate this with the library ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"GzxYjQDoRg"},{"type":"inlineCode","value":"odc-stac","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"zPXkTwcl4J"},{"type":"text","value":". Here we can define what data will loaded as ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JXwQ8N6Hlh"},{"type":"inlineCode","value":"bands","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"TUvNqblx6O"},{"type":"text","value":"; in this case VV sigma naught. Moreover we can resample the data by providing any coordinate reference system (CRS) and resolution as well as a method for resampling of continuos data (e.g. bilinear resampling). In the example below we use the EQUI7 Grid of Europe and a 20 meter sampling. This is the native format of sigma naught stored at EODC, so there will be no actual resampling. Note, also, that resampling is not advisable for this data, as it is provided on a logarithmic scale. More about this in the notebook “Backscattering Coefficients”.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"SHGmjNSJxo"}],"key":"hRURnP8lNG"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"The chunks argument is an advancement method for performing parallel computations on the data. We will not cover this in further detail.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"upXR3OIoSP"}],"key":"k2wZbnQNpf"}],"key":"DX1GZcEEb4"}],"key":"ZzIdoVUvEN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"bands = \"VV\"  # Vertical-vertical polarized\ncrs = \"EPSG:27704\"  # Coordinate Reference System: EQUI7 Grid of Europe\nres = 20  # 20 meter\nchunks = {\"time\": 1, \"latitude\": 1000, \"longitude\": 1000}\nsig0_dc = odc_stac.load(\n    items_eodc,\n    bands=bands,\n    crs=crs,\n    resolution=res,\n    bbox=bounding_box,\n    chunks=chunks,\n    resampling=\"bilinear\",\n)","key":"ZsErdgNVKK"},{"type":"outputs","id":"joFzbbLbeCljRFrewzk8k","children":[],"key":"l047NXXf5u"}],"key":"JhqQeGqNF4"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Let’s have a look at the VV polarized band of the dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NEJTggzJ5B"}],"key":"yuahZGwrgP"}],"key":"zLNUZsH0n1"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sig0_dc.VV","key":"ZGKyFh3O8W"},{"type":"outputs","id":"N6AU-Tnv9_TkWccAZ1x4n","children":[],"key":"ENbSwWuSEK"}],"key":"EESRmLP8f5"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"As we can see, the data is stored as a ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vxyd6fOn5A"},{"type":"inlineCode","value":"xarray","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LKgTz1ZWqo"},{"type":"text","value":" DataArray. Xarray is a convenient package for multidimensional labeled arrays, like temperature, humidity, pressure, different bands of satellite imagery, and so on. ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WoDsSRPv64"},{"type":"link","url":"https://docs.xarray.dev/en/stable/index.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The link","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TtBl2YjB8k"}],"urlSource":"https://docs.xarray.dev/en/stable/index.html","key":"H329ucqSxz"},{"type":"text","value":" provides detailed documentation. In a later notebook we will explore some more of the functionality of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UCIK5lW9m4"},{"type":"inlineCode","value":"xarray","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ks1dl9GnoE"},{"type":"text","value":". As we can see in the coordinates, the data here consists of 21 time steps.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bICLuqMB9J"}],"key":"XUJ8nEh9KI"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In general, data from STAC is “lazily” loaded, which means that the structure of the DataArray is constructed, but the data is not loaded yet. It is loaded only at instance when it is needed, for example, for plotting, computations, and so on.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"k6u09e7szy"}],"key":"FpGGYgkJlW"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Since the DataArray has currently a size of almost 18 GiB, we will subset it to the region of Vienna.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SI7ftZWIEN"}],"key":"FE1onLi1Zh"}],"key":"FZEFRprZkF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Create a bounding box covering the region of Vienna\nlatmin_smaller, latmax_smaller = 48, 48.4\nlonmin_smaller, lonmax_smaller = 16, 16.5\n\nsmaller_bounding_box = [\n    [latmin_smaller, lonmin_smaller],\n    [latmax_smaller, lonmax_smaller],\n]\n\nmap = folium.Map(\n    location=[\n        (latmin_smaller + latmax_smaller) / 2,\n        (lonmin_smaller + lonmax_smaller) / 2,\n    ],\n    zoom_start=8,\n    zoom_control=False,\n    scrollWheelZoom=False,\n    dragging=False,\n)\n\nfolium.GeoJson(area_of_interest, name=\"Area of Interest\").add_to(map)\n\nfolium.Rectangle(\n    bounds=smaller_bounding_box,\n    color=\"red\",\n).add_to(map)\n\nfor item in items_eodc:\n    image_url = item.assets[\"thumbnail\"].href\n    bounds = item.bbox\n    folium.raster_layers.ImageOverlay(\n        image=image_url,\n        bounds=[[bounds[1], bounds[0]], [bounds[3], bounds[2]]],\n    ).add_to(map)\n\nfolium.LayerControl().add_to(map)\n\nmap","key":"lhd7uAhtax"},{"type":"outputs","id":"l9XIYcF-fNzy3CWUh-kOP","children":[],"key":"AMh9O71LKD"}],"key":"fTvlA0x8Zm"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure 2: Map of study area. Blue rectangle is the area covered by the discovered data. Red rectangle covers the selected data.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ldJoVQCSdh"}],"key":"rsq59JrZhK"}],"key":"gyAz4s0Oz1"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Create a new dataset with the smaller bounding box covering the region of Vienna. We will leave out the arguments for resampling and directly use the native format as defined in the metadata.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bWlVeEUD5T"}],"key":"uaqB6O0TVf"}],"key":"s6Pzf9dOMR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sig0_dc = odc_stac.load(\n    items_eodc,\n    bands=bands,\n    bbox=[lonmin_smaller, latmin_smaller, lonmax_smaller, latmax_smaller],\n    chunks=chunks,\n)","key":"opwzCuZeAB"},{"type":"outputs","id":"ywXnHBn-i8OTeJiOiS2wX","children":[],"key":"WONedYKrEj"}],"key":"HdYmSvMfbp"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Due to the way the data is acquired and stored, some items include “no data” areas. In our case, no data has the value -9999, but this can vary from data provider to data provider. This information can usually be found in the metadata. Furthermore, to save memory, data is often stored as integer (e.g. 25) and not in float (e.g. 2.5) format. For this reason, the backscatter values are often multiplied by a scale factor, in this case factor 10.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lxlopmjsgT"}],"key":"CiA6swLhHE"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"As Sentinel-1 satellites overpasses Austria every few days, only some time steps of the dataset will have physical data. As a final step, we will now decode the data and create a plot of two consecutive Sentinel-1 acquisitions of Vienna.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sb4jwsdCjC"}],"key":"W5BuOIWiyC"}],"key":"WKbkQrvNgL"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Retrieve the scale factor and NoData value from the metadata. raster:bands is\n# a STAC raster extension\nscale = item.assets[\"VV\"].extra_fields.get(\"raster:bands\")[0][\"scale\"]\nnodata = item.assets[\"VV\"].extra_fields.get(\"raster:bands\")[0][\"nodata\"]\n\n# Decode data with the NoData value and the scale factor\nsig0_dc = sig0_dc.where(sig0_dc != nodata) / scale\n\n# We should remove unnecessary dates when there was no data\n# (no satellite overpass)\nsig0_dc = sig0_dc.dropna(dim=\"time\")","key":"M2sz4eDeAB"},{"type":"outputs","id":"s8e1rsmmBPCMwlLl8PqiB","children":[],"key":"lv82u1ae6I"}],"key":"VsFJM3BVws"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sig0_dc.VV.plot(col=\"time\", robust=True, cmap=\"Greys_r\", aspect=1, size=10)","key":"YFEjjtPYtf"},{"type":"outputs","id":"5Vh4bFwmQyFjt3n7UaPsx","children":[],"key":"aVxCVoOQNI"}],"key":"vMqGJE1rNI"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Figure 3: Sentinel-1 microwave backscatter image for two timeslices.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AD9Gz0CRUv"}],"key":"Ebr7WwnTGT"}],"key":"he9qpdDmJi"}],"key":"CnNYMqZlbL"}],"key":"rbAfHvwXoI"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Microwave Remote Sensing","url":"/notebooks/courses/microwave-remote-sensing","group":"Courses"},"next":{"title":"Unit Conversion","url":"/notebooks/courses/microwave-remote-sensing/unit-01/in-class-exercise-1","group":"Courses"}}},"domain":"http://localhost:3000"}